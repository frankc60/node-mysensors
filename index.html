<!DOCTYPE html>
<head>
	<meta charset="utf-8">
	
<script src="/bower/jquery/dist/jquery.min.js"></script>

  

   <script src="/bower/Chart.js/dist/Chart.bundle.js"></script>
 

</head>
<body>

<canvas id="myChart" width="300" height="150"></canvas>

<div class="ct-chart ct-perfect-fourth"></div>



  <div id="line_top_x"></div>

       <time></time>
        <div id="container">Try to change your xml data to update this content</div>

<div id="data">xx</div>

    <script src="/socket.io/socket.io.js"></script>
    
    <script>
    // creating a new websocket
    var socket = io.connect('http://localhost:8000');
    // on every message recived we print the new datas inside the #container div
    socket.on('notification', function (data) {
        // convert the json string into a valid javascript object
        var _data = JSON.parse(data);

        $('#container').html(_data.test.sample);
        $('time').html('Last Update:' + new Date());
    });


var dData = function() {
  return Math.round(Math.random() * 90) + 10;
};


var data = {
    labels: [],
    datasets: [
        {
            label: "Temperature",
       
            fill: false,
            lineTension: 0.1,
            backgroundColor: "rgba(75,192,192,0.4)",
            borderColor: "rgba(75,192,192,1)",
            borderCapStyle: 'butt',
            borderDash: [],
            borderDashOffset: 0.0,
            borderJoinStyle: 'miter',
            pointBorderColor: "rgba(75,192,192,1)",
            pointBackgroundColor: "#fff",
            pointBorderWidth: 1,
            pointHoverRadius: 5,
            pointHoverBackgroundColor: "rgba(75,192,192,1)",
            pointHoverBorderColor: "rgba(220,220,220,1)",
            pointHoverBorderWidth: 2,
            pointRadius: 1,
            pointHitRadius: 10,
            data: [],
        }
    ]
};  

var ctx = $("#myChart");

var myLineChart = new Chart(ctx, {
    type: 'line',
    data: data,
    options: {
        xAxes: [{
            display: true
        }]
    }
});


var index=0;
 socket.on("update", function (data) {

    	$("#data").append("<br/>" + new Date() + " - " + data);
    	console.log(data);

		var regData = data.match(/\(1\:42\).+data:(.+)/);

var index;

		if(regData) {
			index = myLineChart.data.datasets[0].data.length;

			

			var d = new Date(); // for now
			d.getHours(); // => 9
			d.getMinutes(); // =>  30
			d.getSeconds(); // => 51
			var tme = d.getHours() + ":" + d.getMinutes() + ":" + d.getSeconds();

			myLineChart.data.datasets[0].data[index] = regData[1]; 

			myLineChart.data.labels[index] = tme;
			myLineChart.update();

		} else {
			//alert(regData);
		};
	});


</script>
</body>
</html>